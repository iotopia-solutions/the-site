{"version":3,"sources":["routes/pages.js"],"names":["index","req","res","readFile","__dirname","err","text","parts","split","then","extractPosts","posts","map","post","send","sections","join","catch","JSON","parse","resp","body"],"mappings":";;;;;;;AAAA;;;;AACA;;AACA;;AACA;;;;;;AAEA;AACO,IAAMA,wBACT,SADSA,KACT,CAACC,GAAD,EAAMC,GAAN;AAAA,SACA,aAAGC,QAAH,CACEC,YAAY,yBADd,EACyC,MADzC,EAEE,UAACC,GAAD,EAAMC,IAAN,EAAe;AACb;AACA,QAAID,GAAJ,EAAS,MAAMA,GAAN;AACT;AACA,QAAME,QAAQD,KAAKE,KAAL,CAAW,wBAAX,CAAd;AACA,kCACGC,IADH,CACQC,YADR,EAEGD,IAFH,CAEQ;AAAA,aAASE,MAAMC,GAAN;AACb;AACA;AAAA,eAAQ,kCAAqB,4BAAaC,IAAb,CAArB,CAAR;AAAA,OAFa,CAAT;AAAA,KAFR,EAMGJ,IANH,CAMQ;AAAA,aAAYP,IAAIY,IAAJ,CAASP,MAAM,CAAN,IAAWQ,SAASC,IAAT,CAAc,EAAd,CAAX,GAA+BT,MAAM,CAAN,CAAxC,CAAZ;AAAA,KANR;AAOE;AAPF,KAQGU,KARH,CAQS;AAAA,aAAOf,IAAIY,IAAJ,CAAS,yBAAyBT,GAAlC,CAAP;AAAA,KART;AASD,GAhBH,CADA;AAAA,CADG;;AAqBP,IAAMK,eACF,SADEA,YACF;AAAA,SAAQQ,KAAKC,KAAL,CAAWC,KAAK,CAAL,EAAQC,IAAnB,EAAyBV,KAAjC;AAAA,CADJ","file":"routes/pages.js","sourcesContent":["import fs from 'fs';\nimport { getPosts } from '../blog/wordpressApi';\nimport { renderToStaticMarkup } from 'react-dom/server';\nimport blogsSection from '../blog/blogsSection';\n\n// TODO: read and process the template index file at load time.\nexport const index\n  = (req, res) =>\n    fs.readFile(\n      __dirname + '/../../views/index.html', 'utf8',\n      (err, text) => {\n        // fail hard\n        if (err) throw err;\n        // render blog posts\n        const parts = text.split('<!-- blogs-go-here -->');\n        getPosts()\n          .then(extractPosts)\n          .then(posts => posts.map(\n            // TODO: somehow get an aditional className, \"last\", onto last post\n            post => renderToStaticMarkup(blogsSection(post))\n          ))\n          .then(sections => res.send(parts[0] + sections.join('') + parts[1]))\n          // TODO: handle more errors and log this, too.\n          .catch(err => res.send('No blog posts found.' + err));\n      }\n    );\n\nconst extractPosts\n  = resp => JSON.parse(resp[0].body).posts;\n"],"sourceRoot":"/Users/john/Code/the-site/es6"}